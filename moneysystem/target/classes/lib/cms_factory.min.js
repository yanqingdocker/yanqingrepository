var search_mc;

function cleanTip(condition) {
    var $gq = $('#wd');
    if ($gq.val() == $gq.attr('title')) {
        $gq.val('').removeClass('grey');
    } else if ($gq.val() == "" && condition == 'blur') {
        $gq.val($gq.attr('title')).addClass("grey");
    }
}

function kKeyUp(e, v) {
    GetSearchResult(e, v, 'search_tip');
}

function kBlur() {
    Fid('search_tip').style.display = 'none';
    hiddenSelect('show');
}

function changeSearchTip(e) {
    $('#inputtit').blur();
    if (Fid('search_tip').style.display == 'none') {
        kKeyUp(e, $('#wd').val());
    } else {
        $('#search_tip').hide();
    }
}

function clearChangeResultClass(num) {
    if (Fid('r_' + num)) Fid('r_' + num).className = 'searchResultli';
}

function changeResultClass(total, num) {
    for (var i = 0; i <= total; i++) {
        if (i == num) {
            if (Fid('r_' + i)) Fid('r_' + i).className = 'resultFocusLi';
            Fid('wd').value = Fid('text_' + i).innerHTML;
        } else {
            if (Fid('r_' + i)) Fid('r_' + i).className = 'searchResultli';
        }
    }
}

function searchsubmit() {
    var typeid = getObjVal('#typeid');
    var wd = getObjVal('#wd');
    if (wd == $('#wd').attr('title') || wd == '') layerAlert('', '请输入搜索的关键字');
    else top.location.href = '/search.html?wd=' + escape(wd) + '&sm=content&smid=' + escape(typeid);
}

function clean_content_tip(condition) {
    var $gq = $('#s_wd');
    if ($gq.val() == $gq.attr('title')) {
        $gq.val('').removeClass('grey');
    } else if ($gq.val() == "" && condition == 'blur') {
        $gq.val($gq.attr('title')).addClass("grey");
    }
}

function content_search() {
    var cid = getObjVal('#s_cid');
    var wd = getObjVal('#s_wd');
    if (wd == $('#s_wd').attr('title') || wd == '') layerAlert('', '请输入要搜索的关键字');
    else top.location.href = '/search.html?cid=' + escape(cid) + '&sm=content&wd=' + escape(wd);
}

function buser_search() {
    var city = getObjVal('#s_city');
    var wd = getObjVal('#s_wd');
    if (wd == $('#s_wd').attr('title') || wd == '') layerAlert('', '请输入要搜索的关键字');
    else top.location.href = '/search.html?city=' + escape(city) + '&sm=buser&wd=' + escape(wd);
}

function searchList(tempid, tag, hotKey) {
    var vt = Request("vt");
    var typeid = Request("t");
    var act = Request("act");
    var orderby = Request("o");
    var wd = Request("wd");
    var CurrentPage = Request("page");
    if (CurrentPage == "") {
        CurrentPage = 1;
    } else {
        CurrentPage = parseInt(Request("page"));
    }
    var PageSize = 12;
    var listNumStyle = 8;
    var obj = '#' + tag;
    if (typeid == '') {
        typeid = '0'
    }
    if (orderby == '') {
        orderby = 'normal'
    }
    $(document).ready(function() {
        $('#type_menu li').each(function() {
            if ($(this).attr('rel') == unescape(typeid)) {
                $(this).attr('class', 'on');
            } else {
                $(this).attr('class', 'nor');
            }
        });
        $('#orderby_menu li').each(function() {
            if ($(this).attr('rel') == unescape(typeid)) {
                $(this).attr('class', 'on');
            } else {
                $(this).attr('class', 'nor');
            }
        });
        if (wd != '') {
            $('#wd').attr('value', unescape(wd));
        }
        if (typeid != '') {
            $('#typeid').val(typeid);
        }
        if ($('#search_key').length > 0) {
            $('#search_key').html('关键字:' + unescape(wd));
        }
        typeid = $('#typeid').val();
        wd = $('#wd').val();
        var $gq = $('#wd');
        if ($gq.val() != $gq.attr('title')) {
            $gq.removeClass('grey');
        } else {
            wd = ''
        }
        if (wd == '') {
            if (hotKey != '') {
                hotKey = unescape(hotKey);
                hotKey.replace(',', '</b>,<b>');
                hotKey = '<b>' + hotKey + '</b>'
            }
            $(obj).html('<div class="warningDiv"><img src="/lib/Images/layer/tip.gif" alt="提示" class="picMiddle" /><span class="fontBold"> 你可以输入关键词如“' + hotKey + '”进行搜索</span>\
    <ol class="fontLarge" style="list-style-type:decimal;">\
      <li>在保证满足搜索要求的前提下尽可能的缩短关键词。</li>\
      <li>换用较常见的关键词。</li>\
      <li>你可以我们的客服代表取得联系。反映您遇到的问题。</li>\
    </ol>\
     </div>');
        } else {
            $('#locationtitle').html('关键字:' + unescape(wd));
            layerLoad("正在搜索，请稍后", 0, null);
            search_mc = new Model();
            search_mc.AjaxComon('', '/lib/ajax/common/' + Config.xmlDefaultPage + '?action=searchlist', 'wd=' + escape(wd) + '&typeid=' + typeid + '&order=' + orderby + '&id=' + tempid + '&page=' + CurrentPage, obj);
        }
    });
}

function GetSearchResult(e, val, id) {
    var typeid = $('#typeid').val();
    var types = $('#types').val();
    var tag = Fid(id);
    var jtag = '#' + id;
    var c;
    val = val.replace(/ /g, '');
    var k = e.keyCode;
    if (k != 13 && k != 16 && k != 17 && k != 27 && k != 37 && k != 38 && k != 39 && k != 40 && k != 144) {
        c = function() {
            if (val != '' && val.length > 1) {
                $.post('/lib/ajax/common/' + Config.xmlDefaultPage + '?action=search_tip&r=' + Math.random(), {
                    val: escape(val),
                    typeid: typeid,
                    types: types
                }, function(result) {
                    if (result.success) {
                        var json = result.data.list;
                        var tiphtml = "";
                        tiphtml = '<div id="searchResultDiv"><input type="hidden" id="searchResultCount" value="' + json.length + '" /><ol>';
                        for (var i = 0; i < json.length; i++) {
                            tiphtml += '<li class="searchResultli" id="r_"' + i + '" onmouseover="javascript: changeResultClass(' + json.length + ',' + i + ');" onmouseout="javascript: clearChangeResultClass(' + i + ');" onclick="javascript: $(\'#searchResult\').hidden();"><span id="text_' + i + '">' + json[i].title + '</span></li>';
                        }
                        tiphtml += "</ol></div>";
                        $(jtag).html(tiphtml);
                        if (json.length > 0) {
                            if (tag.style.display == 'none' && val.replace(/ /g, '') != '') {
                                showTr(id);
                                tag.style.opacity = 0.85;
                                tag.style.filter = 'Alpha(opacity=85)';
                                tag.style.zIndex = 7777;
                            }
                            hiddenSelect('hidden');
                        }
                    } else {
                        $(jtag).html('<div id="searchResultDiv"><input type="hidden" id="searchResultCount" value="' + result.msg + '" /><ol></ol></div>');
                    }
                }, "json");
            } else {
                tag.style.display = 'none';
            }
            clearTimeout(c);
        };
        setTimeout(c, 500);
    } else if (k == 27 || k == 32) {
        tag.style.display = 'none';
    } else if (k == 13) {
        tag.style.display = 'none';
        searchsubmit();
    } else if (k == 38 || k == 40) {
        if (tag.style.display != 'none' && Fid('searchResultDiv')) {
            var t = -1;
            var j = Fid('searchResultCount').value - 1;
            for (var i = 0; i <= j; i++) {
                if (Fid('r_' + i) && Fid('r_' + i).className == 'resultFocusLi') {
                    Fid('r_' + i).className = 'searchResultli';
                    t = i;
                }
            }
            if (k == 40) t = t + 1;
            if (k == 38) t = t - 1;
            if (t > j) t = 0;
            if (t < 0) t = j;
            if (Fid('r_' + t)) {
                Fid('r_' + t).className = 'resultFocusLi';
                Fid('wd').value = Fid('text_' + t).innerHTML;
            }
        }
    }
}

function setCaret(textObj) {
    if (textObj.createTextRange) textObj.caretPos = document.selection.createRange().duplicate();
}

function insertAtCaret(textObj, textFeildValue) {
    if (document.all) {
        if (textObj.createTextRange && textObj.caretPos) {
            var caretPos = textObj.caretPos;
            caretPos.text = caretPos.text.charAt(caretPos.text.length - 1) == '' ? textFeildValue + '' : textFeildValue;
        } else textObj.value = textFeildValue;
    } else {
        if (textObj.setSelectionRange) {
            var rangeStart = textObj.selectionStart;
            var rangeEnd = textObj.selectionEnd;
            var tempStr1 = textObj.value.substring(0, rangeStart);
            var tempStr2 = textObj.value.substring(rangeEnd);
            textObj.value = tempStr1 + textFeildValue + tempStr2;
        } else alert("This version of Mozilla based browser does not support setSelectionRange");
    }
}

function GetLength(obj) {
    var iLength;
    if (getOs() == 'Opera') {
        iLength = Fid(obj).value.replace(/[^\x00-\xff]/g, "**").length;
    } else {
        var oEditor = CKEDITOR.instances[obj];
        var oDOM = oEditor.EditorDocument;
        if (document.all) iLength = oDOM.body.innerText.length;
        else {
            var r = oDOM.createRange();
            r.selectNodeContents(oDOM.body);
            iLength = r.toString().length;
        }
    }
    return iLength;
}

function getByteLen(val) {
    var len = 0;
    for (var i = 0; i < val.length; i++) {
        if (val[i].match(/[^\x00-\xff]/ig) != null) {
            len += 2;
        } else {
            len += 1;
        }
    }
    return len;
}

function createEditor(virtualRoot, toolBarSet, wid, hei, tagObj, showType) {
    if (toolBarSet == undefined || toolBarSet == '') {
        toolBarSet = 'Basic';
    }
    if (wid == undefined || wid == '') {
        wid = '98%'
    }
    if (hei == undefined || hei == '') {
        hei = 100;
    }
    if (showType == 0) {
        oFCKeditor.Create();
        CKEDITOR.appendTo(tagObj, {
            customConfig: '/lib/ckeditor/user_config.js',
            toolbar: toolBarSet,
            width: wid,
            height: hei
        }, '');
    } else {
        CKEDITOR.replace(tagObj, {
            customConfig: '/lib/ckeditor/user_config.js',
            toolbar: toolBarSet,
            width: wid,
            height: hei
        });
    }
}

function checkLoadEditor() {
    if (window.CKEDITOR) {
        (function() {
            var showCompatibilityMsg = function() {
                var env = CKEDITOR.env;
                var html = '<p><strong>Your browser is not compatible with CKEditor.</strong>';
                var browsers = {
                    gecko: 'Firefox 2.0',
                    ie: 'Internet Explorer 6.0',
                    opera: 'Opera 9.5',
                    webkit: 'Safari 3.0'
                };
                var alsoBrowsers = '';
                for (var key in env) {
                    if (browsers[key]) {
                        if (env[key]) html += ' CKEditor is compatible with ' + browsers[key] + ' or higher.';
                        else alsoBrowsers += browsers[key] + '+, ';
                    }
                }
                alsoBrowsers = alsoBrowsers.replace(/\+,([^,]+), $/, '+ and $1');
                html += ' It is also compatible with ' + alsoBrowsers + '.';
                html += '</p><p>With non compatible browsers, you should still be able to see and edit the contents (HTML) in a plain text field.</p>';
                var alertsEl = Fid('alerts');
                alertsEl && (alertsEl.innerHTML = html);
            };
            var onload = function() {
                if (!CKEDITOR.env.isCompatible) showCompatibilityMsg();
            };
            if (window.addEventListener) window.addEventListener('load', onload, false);
            else if (window.attachEvent) window.attachEvent('onload', onload);
        })();
    }
}

function insertLocalFileToEditer(filename, extname, filepath, filesize, tag) {
    switch (extname) {
        case 'jpg':
        case 'gif':
        case 'jpeg':
        case 'bmp':
        case 'png':
            insertHTML(tag, '<img alt="' + filename + '" title="' + filename + '" src="' + filepath + '" />');
            break;
        default:
            insertHTML(tag, '<img src="/Lib/Images/File/' + extname + '.gif" style="border:0px; vertical-align:middle;" alt="" /> <a href="' + unescape(filepath) + '" rel="external">' + unescape(filename) + '.' + extname + '</a> [' + filesize + ']');
            break;
    }
}

function insertHTML(obj, str) {
    var oEditor = CKEDITOR.instances[obj];
    if (oEditor.mode == 'wysiwyg') {
        oEditor.insertHtml(str);
    } else alert('You must be in WYSIWYG mode!');
}

function insertText(obj, str) {
    var oEditor = CKEDITOR.instances[obj];
    if (oEditor.mode == 'wysiwyg') {
        oEditor.insertText(str);
    } else alert('You must be in WYSIWYG mode!');
}

function setContents(obj, str) {
    var oEditor = CKEDITOR.instances[obj];
    oEditor.setData(str);
}

function getContents(obj) {
    var oEditor = CKEDITOR.instances[obj];
    return oEditor.getData();
}

function executeCommand(obj, commandName) {
    var oEditor = CKEDITOR.instances[obj];
    if (oEditor.mode == 'wysiwyg') {
        oEditor.execCommand(commandName);
    } else alert('You must be in WYSIWYG mode!');
}

function sysAjax(loadTxt, postUrl, dataStr, tag) {
    model.AjaxComon('<img style="border:0px;" align="absmiddle" src="' + Config.webRoot + '/Lib/Images/Loading/Loading2.gif" alt="Loading..." />' + loadTxt, postUrl, dataStr, tag);
}

function GetServerData(resultType, virtualRoot, act, val1, val2, val3, val4, tagObj) {
    new Model().AjaxComon('', '/lib/ajax/SysFlag/' + Config.xmlDefaultPage + '?action=getserverdata', 'obj=' + act + '&val1=' + val1 + '&val2=' + val2 + '&val3=' + val3 + '&val4=' + val4, '#' + tagObj, 1, 'POST', resultType);
}
var mc_ch_rg;

function CheckInfoRead(classid, infoid, pageNo) {
    layerLoad("请稍后..");
    clearTimeout(mc_ch_rg);
    mc_ch_rg = setTimeout(function() {
        $.ajax({
            type: "POST",
            url: '/api/common/info_read/check_read?' + Math.random(),
            data: 'infoid=' + infoid + '&classid=' + classid + '&page=' + pageNo,
            cache: false,
            async: true,
            dataType: 'json',
            timeout: 5000,
            success: function(json) {
                layerClose('load_wait');
                if (json.error == 'login_fail') {
                    layerResult('阅读当前内容需要登录会员', 1500, function() {
                        loginForm();
                    });
                    return true;
                }
                $('#Info_' + infoid).html(unescape(json.msg));
                return true;
            },
            error: function(msg) {
                return false;
            }
        });
    }, 100);
}

function ReadWastePoint(classid, infoid, pageNo) {
    layerLoad("请稍后..");
    clearTimeout(mc_ch_rg);
    mc_ch_rg = setTimeout(function() {
        $.ajax({
            type: "POST",
            url: '/api/common/info_read/point_waste?' + Math.random(),
            data: 'infoid=' + infoid + '&classid=' + classid + '&page=' + pageNo,
            cache: false,
            async: true,
            dataType: 'json',
            timeout: 5000,
            success: function(json) {
                layerClose('load_wait');
                if (json.error == 'login_fail') {
                    layerResult('阅读当前内容需要登录会员', 1500, function() {
                        loginForm();
                    });
                    return true;
                }
                $('#Info_' + infoid).html(unescape(json.msg));
                return true;
            },
            error: function(msg) {
                return false;
            }
        });
    }, 100);
}

function GetUserLoginForm(virtualRoot, tempId, formId) {
    xmlHttpPost(false, '', '/lib/ajax/SysFlag/' + Config.xmlDefaultPage + '?action=checkUser', 'tempid=' + tempId + '&id=' + formId, 0, 0, 'LoginForm_' + formId);
}

function ChkUserLogin(virtualRoot, action, formId) {
    var tempid = Fid('tempId').value;
    var usn = Fid('usn').value;
    var psw = Fid('psw').value;
    var code = Fid('code').value;
    var saveCookie = Fid('savecookie').checked;
    if (saveCookie) saveCookie = 1;
    xmlHttpPost(true, '身份验证中，请稍后...', '/lib/ajax/SysFlag/' + Config.xmlDefaultPage + '?action=' + action, 'tempid=' + tempid + '&usn=' + usn + '&psw=' + psw + '&code=' + code + '&savecookie=' + saveCookie + '&id=' + formId, 0, 0, 'LoginForm_' + formId);
}

function GetActionFlagCont(virtualRoot, resultType, flagID, pageNo) {
    var ajaxType = true;
    if (resultType == 3) ajaxType = false;
    xmlHttpPost(ajaxType, 'Loading...', '/lib/ajax/SysFlag/' + Config.xmlDefaultPage + '?action=changePage', 'id=' + flagID + '&page=' + pageNo, 0, 0, 'P_' + flagID)
}

function changePage(virtualRoot, resultType, action, pCount, pButton, pPlace, pType, tagObj, condition) {
    var pNo = '';
    var ajaxType = true;
    if (resultType == 3) ajaxType = false;
    if (pButton == 'First') pNo = 1;
    else if (pButton == 'Previous') {
        if (Fid('P_' + tagObj + '_No0')) pNo = Number(Fid('P_' + tagObj + '_No0').innerHTML) - 1;
        if (Fid('P_' + tagObj + '_No1')) pNo = Number(Fid('P_' + tagObj + '_No1').innerHTML) - 1;
        if (pNo < 1) pNo = 1;
    } else if (pButton == 'Next') {
        if (Fid('P_' + tagObj + '_No0')) pNo = Number(Fid('P_' + tagObj + '_No0').innerHTML) + 1;
        if (Fid('P_' + tagObj + '_No1')) pNo = Number(Fid('P_' + tagObj + '_No1').innerHTML) + 1;
        if (pNo > pCount) pNo = pCount;
    } else if (pButton == 'Last') pNo = pCount;
    else pNo = Number(pButton);
    if (action == 'searchlist') {
        var urltemp = location.search;
        var arrTemp = urltemp.split("&page=");
        var url = arrTemp[0] + '&page=' + pNo;
        location.href = url;
        return true;
    }
    if (pType == 0) {
        for (var i = 1; i <= pCount; i++) {
            if (i == pNo) {
                if (Fid('P_' + tagObj + '_' + i)) Fid('P_' + tagObj + '_' + i).style.display = 'block';
            } else {
                if (Fid('P_' + tagObj + '_' + i)) Fid('P_' + tagObj + '_' + i).style.display = 'none';
            }
        }
    } else {
        new Model().AjaxComon('', '/lib/ajax/SysFlag/' + Config.xmlDefaultPage + '?action=' + action, 'id=' + tagObj + '&page=' + pNo + '&condition=' + unescape(condition).replace(" ", "%20"), '#P_' + tagObj, 1, 'POST', ajaxType);
    }
    if (Fid('P_' + tagObj + '_No0')) Fid('P_' + tagObj + '_No0').innerHTML = pNo;
    if (Fid('P_' + tagObj + '_No1')) Fid('P_' + tagObj + '_No1').innerHTML = pNo;
}

function setWeather(e, virtualRoot, id) {
    var coll = document.getElementsByTagName('div');
    if (!coll) return;
    if (coll.length) {
        for (var i = 0; i < coll.length; i++) {
            if (coll.item(i).className == 'setWeather') {
                coll.item(i).style.display = 'none';
            }
        }
    }
    if (!Fid(id)) {
        createDiv(e, id, 'setWeather');
        xmlHttpPost(true, '', '/lib/ajax/SysFlag/' + Config.xmlDefaultPage + '?action=setweather', 'result=show&id=' + id, 0, 0, id);
    } else {
        Fid(id).style.display = '';
        if ((returnXY(e, 'x') + Fid(id).scrollWidth) > document.documentElement.scrollWidth) {
            Fid(id).style.left = (document.documentElement.scrollWidth - Fid(id).scrollWidth) - 20 + 'px';
        } else {
            Fid(id).style.left = returnXY(e, 'x') + 'px';
        }
        if ((returnXY(e, 'y') + Fid(id).scrollHeight) > document.documentElement.scrollHeight) {
            Fid(id).style.top = (document.documentElement.scrollHeight - Fid(id).scrollHeight) - 20 + 'px';
        } else {
            Fid(id).style.top = (returnXY(e, 'y') + 6) + 'px';
        }
    }
}

function selfLink(e, virtualRoot, id, text) {
    var coll = document.getElementsByTagName("div");
    if (!coll) {
        return;
    }
    if (coll.length) {
        for (var i = 0; i < coll.length; i++) {
            if (coll.item(i).className == "selfLink") {
                coll.item(i).style.display = "none";
            }
        }
    }
    if (!Fid(id)) {
        createDiv(e, id, "selfLink");
        Fid(id).style.opacity = 0.85;
        Fid(id).style.filter = "Alpha(opacity=85)";
        xmlHttpPost(true, '', '/lib/ajax/SysFlag/' + Config.xmlDefaultPage + '?action=showSelfLink', 'title=' + text + '&id=' + id, 0, 0, id);
    } else {
        Fid(id).style.display = "";
        Fid(id).style.left = returnXY(e, "x") + "px";
        Fid(id).style.top = returnXY(e, "y") + 6 + "px";
    }
}

function showRandCode(Codew, Codeh, Tag) {
    var temp = "<img class=\"mt15\" src=\"/lib/code.aspx?k=" + Math.random() + "\" width=\"" + Codew + "\" onClick=\"this.src+=Math.random()\" alt=\"图片看不清？点击重新得到验证码\" style=\"cursor:pointer;border:1px solid #ddd;\" height=\"" + Codeh + "\" hspace=\"4\">";
    $(Tag).html(temp);
}

function getOperaPath() {
    var arrpath = "";
    var opera_path;
    var domainurl = document.location.href.match(/^http:\/\/(.+?)\//i)[0].toLowerCase();
    var file_path = document.location.href.substring(0, document.location.href.lastIndexOf("/") + 1).toLowerCase();
    if (domainurl != '' && file_path != '') {
        opera_path = file_path.replace(domainurl, '');
        arrpath = opera_path.split("/");
    }
    return arrpath[0];
}

function validatorUser(getType, obj) {
    var p = getOperaPath();
    var postUrl;
    var dataStr;
    switch (getType) {
        case "s":
            postUrl = "/lib/ajax/buser/" + Config.xmlDefaultPage + "?action=validatoruser";
            dataStr = "getType=s&p=" + p;
            break;
        case "b":
            postUrl = "/lib/ajax/buser/" + Config.xmlDefaultPage + "?action=validatoruser";
            dataStr = "getType=b&p=" + p;
            break;
        case "u":
            postUrl = "/lib/ajax/User/" + Config.xmlDefaultPage + "?action=validatoruser";
            dataStr = "getType=u&p=" + p;
            break;
    }
    getvalidatorUser(postUrl, dataStr, false, false, "#user_status");
    return true;
}

function getvalidatorUser(postUrl, dataStr, asyncTF, cacheTF, tagObj) {
    var historyLink = document.location.href;
    $.ajax({
        type: "POST",
        url: postUrl + "&r=" + Math.random(),
        data: dataStr,
        cache: false,
        async: true,
        timeout: 5000,
        success: function(msg) {
            if (unescape(msg) == 'False') {
                location.href = '/login.shtml?url=' + historyLink;
                return false;
            } else if (unescape(msg) == 'isb') {
                location.href = '/buser';
                return false;
            } else if (unescape(msg) == 'iss') {
                location.href = '/school';
                return false;
            } else if (unescape(msg) == 'ist') {
                location.href = '/train';
                return false;
            } else if (unescape(msg) == '1') {
                $(tagObj).html('');
                return true;
            } else {
                $(tagObj).html('');
                return true;
            }
        },
        error: function(msg) {
            $(tagObj).html('');
            return false;
        }
    });
}

function loginForm() {
    var option = {
        no_cancel: false,
        no_submit: false,
        zIndex: 3500,
        cancel_callback: function() {
            location.href = '/'
        },
        close_callback: function() {
            location.href = '/'
        }
    };
    var aid = 15000102;
    option.wid = 'layer_login';
    option.div_width = 350;
    option.submit_button_name = '登录';
    option.div_height = 0;
    option.time_out = 0;
    option.submit_not_close = true;
    var _callback = function(userName, password, isSave,randcode, option) {
        userLogin(userName, password, isSave,randcode, option);
    };
    var f_callback = function() {
        var username = '';
        var password = '';
        var save_tf = 1;
        if (loginFormCheckName('#layer_username', '#layer_username_info') && loginFormCheckPassword('#layer_password', '#layer_password_info')) {
            username = getObjVal('#layer_username');
            password = getObjVal('#layer_password');
            randcode = getObjVal('#randcode');
            save_tf = getBoxVal('layer_save');
        } else {
            alert('您所填写的登录信息有误');
            return;
        }
        _callback(username, password, save_tf,randcode);
    };
    option.submit_callback = f_callback;
    $(document).ready(function() {
        if ($('#UserName').length > 1 || $('#UserPwd').length > 1) {
            location.href = '/login.shtml';
        }
    });
    var html = '<div id="layer_login_form" class="layer_login">\
   <p>\
  <label for="UserName" class="f14 g3">账号：</label>\
  <input type="text" id="layer_username" size="25" onblur="loginFormCheckName(this,\'#layer_username_info\');" onkeydown="javascript: if(event.keyCode == 13) Fid(\'layer_login_submit\').click();" class="form-control " /> </p>\
    <div class="line_txt"> <span class="hint" id="UserName_info">企业账号、个人会员E-Mail</span></div>\
   <p>\
  <label for="UserPwd" class="f14 g3">密码：</label>\
  <input type="password" id="layer_password" size="25" onblur="loginFormCheckPassword(this,\'#layer_password_info\');" onkeydown="javascript: if(event.keyCode == 13) Fid(\'layer_login_submit\').click();" class="form-control  "/> </p>\
   <div class="line_txt"> <span class="hint" id="UserPwd_info">请输入您的密码</span></div>\
   <p style="display: none;" id="code_block">\
  <input  name="randcode" class="form-control " id="randcode" onfocus="this.placeholder = \'\'" onblur="this.placeholder = \'输入请验证码\'" placeholder=" 输入请验证码" type="text" style="width: 155px;display:  inline-block;*display:inline;*zoom:1"> <img id="codeimg" src="/lib/code.aspx?k=2966" onclick="this.src+=Math.random()" alt="图片看不清？点击重新得到验证码" style="cursor:pointer;margin-top: 3px;" width="90" hspace="4" height="35"></p>\
   <p class="displayNone" id="showcooksave">\
  <label for="save">保存：</label>\
  <input type="checkbox" id="layer_save" value="1" class="picMiddle" name="layer_save"/>\
  <span class="hint">保存登录状态，下次直接登录。</span>\
   </p>\
   <p class="splitDiv"></p>\
   <p style="text-align:center;margin-top: 10px;">\
   <a href="/user/register.shtml" target="_blank" >注册新用户名</a>\
    &nbsp;&nbsp;&nbsp;&nbsp;<a href="/html/find_password.shtml" target="_blank">找回密码</a>\
   </p>\
   <div class="app">';
    if (Config.open_qqapi) {
        html += '<a class="qq" href="javascript:void(0)" onclick="appLoginWin(\'qq\');layerClose(\'layer_login\')">QQ快捷登录</a>';
    }
    if (Config.open_sinaapi) {
        html += '<a class="sina" href="javascript:void(0)" onclick="appLoginWin(\'sina\');layerClose(\'layer_login\')">新浪微博快捷登录</a>';
    }
    html += '</div>\
  </div>';
    layerConfig('会员登录', html, option);
}

function loginFormCheckName(inputObj, tipObj) {
    var _inputObj = returnObj(inputObj);
    var _tipObj = returnObj(tipObj);
    var input = $(_inputObj).val();
    if (input == null || jQuery.trim(input) == "") {
        $(_tipObj).attr("class", "hint check_warning");
        $(_tipObj).html("用户名不能为空");
        return false;
    }
    if (input.indexOf("@") != -1) {
        if (input.length > 4 && input.match(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)) {
            $(_tipObj).attr("class", "hint");
            $(_tipObj).html("该帐号为个人用户");
            return true;
        } else {
            $(_tipObj).attr("class", "hint check_warning");
            $(_tipObj).html("您输入的用户名格式不符号！如果您是个人员员请输入您的E-MAIL；如果您是企业会员请输正常用户名（非邮箱）。")
        }
    } else {
        if (jQuery.trim(input).length < 4 || jQuery.trim(input).length > 20) {
            $(_tipObj).attr("class", "hint check_warning");
            $(_tipObj).html("对不起,您的企业会员号格式不正确");
            return false;
        } else {
            $(_tipObj).attr("class", "hint check_ok");
            $(_tipObj).html("该帐号为企业用户");
            return true;
        }
    }
}

function loginFormCheckPassword(inputObj, tipObj) {
    var _inputObj = returnObj(inputObj);
    var _tipObj = returnObj(tipObj);
    var input = $(_inputObj).val();
    if (input.length < 6 || input.length > 16) {
        $(_tipObj).attr("class", "hint check_warning");
        $(_tipObj).html("密码请使用6-16个字符");
        return false;
    } else {
        $(_tipObj).attr("class", "hint check_ok");
        return true;
    }
}

function userLogin(username, password, isSave,randcode,option) {
    var d = document.domain;
    if (username == undefined || username == '') return false;
    if (password == undefined || password == '') return false;
    option = option ? option : {};
    var op = {
        isLayer: true,
        isSave: isSave
    };
    $.extend(op, option);
    layerLoad("正在登录..");
    var c = function() {
        $.ajax({
            type: "POST",
            url: Config.webRoot + "/api/user/passport/login?r=" + Math.random(),
            data: "username=" + username + "&password=" + password + "&save=" + op.isSave+"&randcode="+randcode,
            dataType: "json",
            cache: false,
            async: true,
            timeout: 5000,
            error: function(msg) {
                layerError('温馨提示', '操作失败！');
                return false;
            },
            timeout: function(msg) {
                layerConfirm('温馨提示', '当前操作超过响应时间!,', function() {
                    logout();
                }, function() {
                    clearTimeout(c);
                }, {
                    submit_button_name: '重试'
                });
                return false;
            },
            success: function(result) {
                var url = location.href.toLowerCase().split('login.shtml?url=');
                var refererUrl = '';
                for (var i = 1; i < url.length; i++) {
                    refererUrl += url[i];
                }
                layerClose('load_wait');
                if(result.error_num>=3){
                    $("#code_block").show();
                    $("#codeimg").click();
                }
                if (result.success) {

                    if (op.isLayer) {
                        layerClose('layer_login', function() {
                            layerResult('登录成功..', 1500, function() {
                                location.reload();
                            })
                        });
                    } else {
                        layerResult('登录成功..');
                        if (refererUrl == '') location.href = Config.userPath;
                        else location.href = refererUrl;
                    }
                    return true;
                } else {
                    return layerError('温馨提示', result.msg);
                }
            }
        });
    };
    setTimeout(c, 1000);
}

function logout() {
    var d = document.domain;
    var returnurl = '0';
    if (arguments[0] != undefined) returnurl = arguments[0];
    layerLoad("正在退出..");
    var c = function() {
        $.ajax({
            type: "POST",
            url: Config.webRoot + '/api/user/passport/logout?&r=' + Math.random(),
            data: 'go=ok',
            cache: false,
            async: true,
            timeout: 5000,
            dataType: "json",
            error: function(msg) {
                layerError('温馨提示', '操作失败！');
                return false;
            },
            timeout: function(msg) {
                layerConfirm('温馨提示', '当前操作超过响应时间!,', function() {
                    logout();
                }, function() {
                    clearTimeout(c);
                }, {
                    submit_button_name: '重试'
                });
                return false;
            },
            success: function(msg) {
                if (msg.success) {
                    if (returnurl != '0') {
                        var url = location.href.toLowerCase().split('&url=');
                        var refererUrl = '';
                        for (var i = 1; i < url.length; i++) {
                            refererUrl += url[i];
                        }
                        if (refererUrl.indexOf('/login.html') != -1) {
                            location.href = '/login.shtml';
                        } else {
                            location.href = refererUrl;
                        }
                        return true;
                    } else {
                        location.reload();
                        return true;
                    }
                } else {
                    layerError('温馨提示', '操作失败！');
                    return false;
                }
            }
        });
    };
    setTimeout(c, 1000);
}
var login_callback = function(json) {
    $(document).ready(function() {
        if (json.success) {
            if (json.islogin) {
                $(obj).append('<span>|</span><a href="' + json.userurl + '"><span class="strong blue">' + json.data.nickname + '</span></a> 欢迎回来!');
                $(obj).append('<span>|</span><a href="' + json.userurl + '">个人中心</a>');
                $(obj).append('<span>|</span><a href="' + json.carturl + '" target="_blank">购物车[<b id="header_cart_count">' + json.cartcount + '</b>]件</a>');
                $(obj).append('<span>|</span><a href="javascript:;" onclick="logout()">退出</a> ');
            } else {
                $(obj).append('<span>|</span><a href="' + json.carturl + '" target="_blank">购物车[<b id="header_cart_count">' + json.cartcount + '</b>]件</a>');
                $(obj).append('<span>|</span><a href="/login.html">登录</a>');
                $(obj).append('<span>|</span><a href="/regedit.html">注册</a>');
            }
        } else {
            $(obj).append('<span>|</span><a href="/login.html">登录</a>');
            $(obj).append('<span>|</span><a href="/regedit.html">注册</a>');
        }
    });
};

function checkLogin(obj, login_callback) {
    $.ajax({
        type: "POST",
        url: Config.webRoot + '/api/user/passport/login_state?r=' + Math.random(),
        data: 'go=ok',
        cache: false,
        async: true,
        timeout: 5000,
        dataType: "json",
        error: function(msg) {
            return false;
        },
        timeout: function(msg) {
            return false;
        },
        success: function(msg) {
            login_callback(msg);
        }
    });
}

function checkUserReg() {
    if ((checkPwd("#password", "#password_info") && checkTwoPwd("#password", "#password2", "#password_info2") && checkAgree('#agreement', '#agreement_info') && $("#email_info").attr("class") == "hint check_ok")) {
        return true;
    } else {
        alert("你资料未填完整，请您填写完整后再提交");
        return false;
    }
}

function userReg() {
    if (checkUserReg()) {
        layerLoad("注册提交中..");
        setTimeout("userReg_Send('randcode','email','password')", 500);
        return true;
    } else {
        return false;
    }
}

function userReg_Send() {
    var aIdArray = new Array("flag=" + Math.random());
    var argLen = arguments.length;
    for (i = 0; i < argLen; i++) {
        aIdArray[i + 1] = "&" + arguments[i] + "=" + escape(getObjVal(arguments[i]));
    }
    $.ajax({
        type: "POST",
        url: "/lib/ajax/" + Config.xmlDefaultPage + "?action=userReg&r=" + Math.random(),
        data: aIdArray.join('') + "&go=ok",
        success: function(result) {
            layerClose('load_wait');
            if (result.success) {
                clearForm();
                layerSuccess('', result.msg, function() {
                    location.href = '/login.shtml';
                });
                return true;
            } else {
                layerError('', result.msg);
                return false;
            }
        },
        error: function(msg) {
            layerClose('load_wait');
            layerError('', "系统出错！请与客服联系！");
        },
        timeout: function(msg) {
            layerClose('load_wait');
            layerError('', "网络超时!请与客服联系！");
        },
        dataType: json
    });
}
var mc_indexB;

function loadIndexBetaInfo() {
    if ($('#login_beta').length > 0) {
        clearTimeout(mc_indexB);
        mc_indexB = setTimeout(function() {
            $.ajax({
                type: "POST",
                url: Config.webRoot + postUrl + '/lib/ajax/Param/' + Config.xmlDefaultPage + '?action=loadindexbeata&r=' + Math.random(),
                data: 'go=ok',
                cache: false,
                async: true,
                timeout: 5000,
                success: function(msg) {
                    if (msg != '') {
                        var Data = (new Function('return [' + msg + ']'))();
                        $('#login_beta').show();
                        $('#logout_beta').hide();
                        $('#login_beta').html('<div class="user_head"><img class="headimg" src="' + unescape(Data[0].nIconBig) + '" /></div>\
     <div class="user_info">\
     <p class="lo_text"><strong>Hi.' + unescape(Data[0].nNickName) + '</strong></p><span >欢迎回来！</span>\
     <p class="lo_text2"><a target="_blank" href="/cart.shtml">会员中心</a> | <a href="/user/orders/">我的订单</a></p>\
     </div>\
      <div class="user_link"><p class="lo_text2"><a target="_blank" href="/cart.shtml">我的购物车[' + unescape(Data[0].CartNum) + ']</a> | <a href="javascript:logout();void(0);">退出</a></p></div>');
                        return true;
                    } else {
                        $('#login_beta').hide();
                        $('#logout_logout').show();
                        return false;
                    }
                },
                error: function(msg) {
                    return false;
                }
            });
        }, 100);
    }
}
var click_mc;

function getClick(module, classid, modelid, idList, tagObj, updateTF) {
    clearTimeout(click_mc);
    var datas = {
        module: module,
        classid: classid,
        modelid: modelid,
        idlist: idList,
        updatetf: updateTF
    };
    click_mc = setTimeout(function() {
        $.ajax({
            type: "POST",
            url: '/lib/ajax/common/' + Config.xmlDefaultPage + '?action=info_click',
            dataType: "json",
            data: datas,
            timeout: 20000,
            success: function(data, textStatus) {
                if (data.success) {
                    $(tagObj).html(data.click);
                } else {
                    $(tagObj).html("0");
                }
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                $(tagObj).html("0");
            }
        });
    }, 100);
}

function getFieldVal(virtualRoot, act, modelid, key, PublicID, tagObj, updateTF) {
    new Model().AjaxComon('', '/lib/ajax/SysFlag/' + Config.xmlDefaultPage + '?action=getFieldVal', 'obj=' + act + '&modelid=' + modelid + '&key=' + key + '&id=' + PublicID + '&updateTF=' + updateTF, '#' + tagObj);
}

function relate_news(virtualRoot, tempType, modelid, tempName, condition, topNum, picOrText, infoid) {
    var data = 'tempType=' + tempType + '&modelid=' + modelid + '&tempName=' + tempName + '&condition=' + unescape(condition).replace(/,/g, '|').replace(/ /g, '|') + '&pic=' + picOrText + '&topNum=' + topNum + '&infoid=' + infoid;
    var tagObj = '#relate_news_' + infoid;
    new Model().AjaxComon('载入中', '/lib/ajax/SysFlag/' + Config.xmlDefaultPage + '?action=relate_news', data, tagObj);
}

function getReNum(virtualRoot, module, modelid, PublicID, tagObj) {
    var data = 'module=' + module + '&modelid=' + modelid + '&id=' + PublicID;
    var tagObj = '#' + tagObj;
    new Model().AjaxComon('载入中', '/lib/ajax/SysFlag/' + Config.xmlDefaultPage + '?action=getReviewNum', data, tagObj);
}

function GetNextOrForwardInfoLink(virtualRoot, modelid, classid, infoid, showtype, option) {
    option = option ? option : {};
    var op = {
        cutnum: 40,
        endstr: '...',
        thumbtf: 0,
        width: 80,
        height: 72
    };
    $.extend(op, option);
    var temp = '';
    var data = 'modelid=' + modelid + '&classid=' + classid + '&infoid=' + infoid + '&cutnum=' + op.cutnum + '&endstr=' + op.endstr + '&showtype=' + showtype + '&thumbtf=' + op.thumbtf;
    $.ajax({
        type: 'POST',
        url: '/lib/ajax/SysFlag/' + Config.xmlDefaultPage + '?action=GetBackOrForwardInfoLink&r=' + Math.random(),
        data: data,
        cache: false,
        async: true,
        timeout: 5000,
        success: function(msg) {
            var cjson = (new Function("return " + msg + ";"))();
            if (cjson.result) {
                var json = cjson.data;
                if (op.thumbtf) {
                    var tit = "下一组";
                    var tit2 = "最后一组";
                    if (showtype == "Forward") {
                        tit = "上一组";
                        tit2 = "最上一页";
                    }
                    if (cjson.data == '') {
                        temp = '<div class="img_wrap"><a href="javascript:alert(\'' + tit2 + '\');" title="' + tit2 + '"><img src="/Lib/Images/nopic_small.gif" class="nopic_small"/></a></div><a href="javascript:alert(\'' + tit2 + '\');">' + tit + '</a>';
                    } else {
                        temp = '<div class="img_wrap"><a href="' + unescape(json.url) + '" title="' + unescape(json.title) + '"><img src="/lib/ajax/?action=smallpic&width=' + op.width + '&height=' + op.height + '&url=' + unescape(json.thumb) + '"  /></a></div><a href="' + unescape(json.url) + '" title="' + unescape(json.title) + '">' + tit + '</a>';
                    }
                } else {
                    if (cjson.data == '') {
                        temp = '';
                    } else {
                        temp = '<a href="' + unescape(json.url) + '" title="' + unescape(json.title) + '">' + unescape(json.title) + '</a>';
                    }
                }
                $('#' + showtype + 'Info_' + infoid).html(temp);
            }
        },
        error: function(msg) {
            return false;
        }
    });
}

function historyUrl() {
    var url = location.href.toLowerCase();
    var urlarr = url.split('?url=');
    var tempurl = urlarr[urlarr.length - 1];
    if (url.indexOf("/login.shtml") != -1) {
        location.href = '/login.shtml';
    } else {
        location.href = '/Login.shtml?url=' + tempurl;
    }
}

function publicInfo(wid, aTag) {
    location.href = '#' + aTag;
    if (parent.document.getElementById('progress')) parent.document.getElementById('progress').style.width = wid;
    if (document.getElementById('progress')) document.getElementById('progress').style.width = wid;
}

function changetree_css(obj) {
    var id = $(obj).attr('id').replace('pic_', '');
    $('.sub_menu').removeClass("on fb blue");
    $('.class_menu').removeClass("con fb blue");
    $('.class_menu .class_child').each(function() {
        var id2 = $(this).attr('id').replace('tr_', '');
        if (id2 != id) {
            $(this).hide();
            $('#menu_' + id2).attr('class', 'menu');
            $('#pic_' + id2).attr('src', Config.webRoot + '/style/Default/Images/Folder/Closed.gif');
        }
    });
    $('#cm_' + id).addClass("con fb blue");
}

function select_class_tree(winid, name, inputid, funcName, option) {
    option = option ? option : {};
    var op = {
        width: 320,
        height: 360,
        parentid: '0',
        remove: '',
        showtype: 'radio',
        ctag: '',
        classtype: '0',
        enable_parent: '1',
        objtype: 'html',
        modelid: ''
    };
    $.extend(op, option);
    var url = '../IFrame/Select_Class.aspx?showType=' + op.showtype + '&parentid=' + op.parentid + '&remove=' + op.remove + '&modelid=' + op.modelid + '&enable_parent=' + op.enable_parent + '&classtype=' + op.classtype;
    window.top.art.dialog({
        title: name,
        id: winid,
        iframe: url,
        width: op.width,
        height: op.height
    }, function() {
        if (funcName) {
            funcName.apply(this, [winid, inputid, op]);
        }
    }, function() {
        window.top.art.dialog({
            id: winid
        }).close()
    });
}

function layerSysMenu(showType, eObj, cObj, option) {
    var title = (showType == 'checkbox') ? '温馨提示：请选择一个或多个栏目' : '温馨提示：请选择一个栏目';
    var _callback = function() {
        if (showType == 'checkbox') {
            return false;
        } else {
            var val = getRadioVal('classid', '#layer_class_cont');
            $('#' + eObj).val(val);
            if (val != '') {
                xmlHttpPost(false, '', '/lib/ajax/System/XmlHttp.aspx', 'action=showsysmenutitle&classid=' + val, 0, 1, cObj);
            }
        }
    };
    option = option ? option : {};
    var op = {
        div_width: 350,
        remove: '',
        parentid: '0',
        iheight: 200
    };
    $.extend(op, option);
    layerHtml(title, '<div id="layer_class_cont" class="frame_contain"></div>', _callback, null, op);
    $('#layer_class_cont').css('height', op.iheight + 'px');
    $("#layer_class_cont").load('../iframe/SelectSysMenu.aspx?showType=' + showType + '&tag=' + eObj + '&tagname=' + cObj + '&parentid=' + op.parentid + '&remove=' + op.remove, {
        limit: 25
    });
}

function layerTempClass(showType, eObj, cObj, option) {
    var title = (showType == 'checkbox') ? '温馨提示：请选择一个或多个栏目' : '温馨提示：请选择一个栏目';
    var _callback = function() {
        if (showType == 'checkbox') {
            return false;
        } else {
            var val = getRadioVal('classid', '#layer_class_cont');
            $('#' + eObj).val(val);
            if (val != '') {
                xmlHttpPost(false, '', '/lib/ajax/System/XmlHttp.aspx', 'action=showtempclasstitle&classid=' + val, 0, 1, cObj);
            }
        }
    };
    option = option ? option : {};
    var op = {
        div_width: 350,
        remove: '',
        parentid: '0',
        iheight: 200
    };
    $.extend(op, option);
    layerHtml(title, '<div id="layer_class_cont" class="frame_contain"></div>', _callback, null, op);
    $('#layer_class_cont').css('height', op.iheight + 'px');
    $("#layer_class_cont").load('../iframe/SelectTempClass.aspx?showType=' + showType + '&tag=' + eObj + '&tagname=' + cObj + '&parentid=' + op.parentid + '&remove=' + op.remove, {
        limit: 25
    });
}

function layerUpload(title, formurl, returnid, option) {
    var motitle = (title ? title : '文件上传');
    option = option ? option : {};
    var op = {
        width: 450,
        wid: 'layer_upload'
    };
    $.extend(op, option);
    var url = formurl + "&wid=" + op.wid;
    window.top.art.dialog({
        title: motitle,
        id: op.wid,
        iframe: url,
        width: op.width,
        height: op.height,
        close: function() {
            var d = window.top.art.dialog({
                id: op.wid
            }).data.iframe;
            var val = d.$('#result').html();
            $('#' + returnid).val(val);
        }
    });
}

function layerLable1(showType, Obj, option) {
    var title = '请选择您要插入到模板中的标签';
    var _callback = null;
    option = option ? option : {};
    var op = {
        div_width: 600
    };
    $.extend(op, option);
    layerHtml(title, '<div id="layer_lable_cont"></div>', _callback, null, op);
    $("#layer_lable_cont").load('../iframe/SelectLable.aspx?edittype=' + showType + '&tagname=' + Obj, {
        limit: 25
    });
}

function layerLable(showType, tagobj, option) {
    var title = '请选择您要插入到模板中的标签';
    option = option ? option : {};
    var op = {
        width: 500,
        height: 420
    };
    $.extend(op, option);
    var lableid = 'layerlable';
    var _callback = function(lableid, tagobj) {
        var d = window.top.art.dialog({
            id: lableid
        }).data.iframe;
        var val = d.$("#label_val").html();
        setLable(showType, tagobj, val);
    };
    var op_param = 'edittype=' + showType + '&tagname=' + tagobj;
    window.top.art.dialog({
        title: title,
        id: lableid,
        iframe: '../lable/index.aspx?' + op_param,
        width: op.width,
        height: op.height
    }, function() {
        _callback(lableid, tagobj);
    }, function() {
        window.top.art.dialog({
            id: lableid
        }).close()
    });
}

function setLable(editType, tag, val) {
    if (editType == '1') {
        insertHTML(tag, val);
    } else {
        insertAtCaret(Fid(tag), val);
    }
    layerClose();
}

function changeModelLable(modelid, obj) {
    var val = $(modelid).val();
    var _obj = returnObj(obj);
    model.Select(_obj, '/lib/ajax/SysFlag/' + Config.xmlDefaultPage + '?action=getmodelfiled', 'modelid=' + val, '选择模型字段');
}

function showOfficeUrl(tag) {
    model.AjaxComon('请稍后', '/lib/ajax/' + Config.xmlDefaultPage + '?action=showlogin', 'a=0', tag);
}

function fileUpLoad(uploadid, name, textareaid, funcName, option, module, classid, auth_key) {
    option = option ? option : {};
    var op = {
        watermark: 0,
        selectimage: 1,
        allowext: 'jpg|gif|png|bmp|jpeg',
        uploadlimit: 1,
        uploadtype: 0
    };
    $.extend(op, option);
    var op_param = '&watermark=' + op.watermark + '&selectimage=' + op.selectimage + '&allowext=' + op.allowext + '&uploadlimit=' + op.uploadlimit;
    var setting = op_param + '&module=' + module + '&classid=' + classid + '&auth_key=' + auth_key;
    window.top.art.dialog({
        title: name,
        id: uploadid,
        iframe: '/Lib/swfupload/file/index.aspx?m=attachment&uploadtype=' + op.uploadtype + setting,
        width: '500',
        height: '420'
    }, function() {
        if (funcName) {
            funcName.apply(this, [uploadid, textareaid]);
        } else {
            submit_ckeditor(uploadid, textareaid);
        }
    }, function() {
        window.top.art.dialog({
            id: uploadid
        }).close()
    });
}

function showDataInfo(action, id, rowid, option) {
    option = option ? option : {};
    var op = {
        title: "详情查看",
        url: '/Lib/ajax/system/index.ashx?action=' + action + "&r=" + Math.random(),
        clickid: 'more_' + rowid,
        tagid: 'hiddenTd_' + rowid,
        trid: 'hiddenTr_' + rowid
    };
    $.extend(op, option);
    changePic('/style/default/Images/Folder/Closed.gif', '/style/default/Images/Folder/Opened.gif', op.clickid);
    if ($('#' + op.trid).is(':hidden')) {
        $.post(op.url, {
            id: id
        }, function(result) {
            $('#' + op.tagid).html(result.msg);
        }, "json");
    }
    showTr(op.trid);
}

function InitAjaxForm(option) {
    option = option ? option : {};
    var op = {
        btnObj: '#form_submit',
        urlObj: '#reurl',
        formObj: '#myform',
        btnTitle: '提交'
    };
    $.extend(op, option);
    var formRequest = function(formData, jqForm, options) {
        layerLoad("正在" + op.btnTitle + "中...");
    };
    var formResponse = function(data) {
        if (data.success) {
            layerResult(data.msg, 1500, function() {
                location.reload();
            });
        } else {
            layerError('', data.msg);
        }
    };
    var formError = function(XMLHttpRequest, textStatus, errmsg) {
        $(op.btnObj).val("再次" + op.btnTitle);
        layerClose('load_wait');
        layerError('', errmsg);
    };
    var ajax_option = {
        type: "post",
        beforeSubmit: formRequest,
        dataType: 'json',
        success: formResponse,
        error: formError,
        timeout: 60000
    };
    return ajax_option;
}

function openEditWin(url, name, w, h) {
    if (!w) w = screen.width - 4;
    if (!h) h = screen.height - 95;
    if (name == undefined) {
        name = '';
    }
    window.open(url, name, "top=100,left=400,width=" + w + ",height=" + h + ",toolbar=no,menubar=no,scrollbars=yes,resizable=yes,location=no,status=no");
}

function omnipotent(id, linkurl, title, close_type, w, h) {
    if (!w) w = 700;
    if (!h) h = 500;
    art.dialog({
        id: id,
        iframe: linkurl,
        title: title,
        width: w,
        height: h,
        lock: true
    }, function() {
        if (close_type == 1) {
            art.dialog({
                id: id
            }).close()
        } else {
            var d = art.dialog({
                id: id
            }).data.iframe;
            var form = d.document.getElementById('dosubmit');
            form.click();
        }
        return false;
    }, function() {
        art.dialog({
            id: id
        }).close()
    });
    void(0);
}
var qqWindow;

function appLoginWin(app_type, option) {
    option = option ? option : {};
    var op = {
        width: 600,
        height: 360
    };
    $.extend(op, option);
    var url = '';
    var title = '';
    switch (app_type) {
        case "qq":
            url = Config.qqconnect;
            title = 'QQ快捷登录';
            qqWindow = window.open(url, title, 'width=' + op.width + ',height=' + op.height + ',menubar=0,scrollbars=1, resizable=1,status=1,titlebar=0,toolbar=0,location=1');
            break;
        case "sina":
            url = Config.sinaconnect;
            title = '新浪微博快捷登录';
            var id = 'app_login_win';
            window.top.art.dialog({
                id: 'app_login_win'
            }).close();
            window.top.art.dialog({
                title: title,
                id: id,
                iframe: url,
                width: op.width,
                height: op.height
            });
            break;
    }
}

function hasClass(obj, cls) {
    return obj.className.match(new RegExp('(\\s|^)' + cls + '(\\s|$)'));
}

function addClass(obj, cls) {
    if (!this.hasClass(obj, cls)) {
        obj.className = $.trim(obj.className) + " " + cls;
    }
}

function removeClass(obj, cls) {
    if (hasClass(obj, cls)) {
        var reg = new RegExp('(\\s|^)' + cls + '(\\s|$)');
        obj.className = $.trim(obj.className.replace(reg, ""));
    }
}

function closeqqWindow() {
    qqWindow.close();
}